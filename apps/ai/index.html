<!-- Unblockify AI App -->

<div class="ai-shell">
  <button class="crtBtn ai-back">← Back</button>

  <div id="chatbox" class="chatbox"></div>

  <div class="input-area">
    <input id="chatInput" type="text" placeholder="Ask Unblockify AI…" />
    <button id="sendButton">Send</button>
  </div>

  <div class="ai-footer">thanks, from M ✌️</div>
</div>

<script>
function initUnblockifyAI() {
  const sendButton = document.getElementById("sendButton");
  const chatInput = document.getElementById("chatInput");
  const chatbox = document.getElementById("chatbox");

  if (!sendButton || !chatInput || !chatbox) {
    console.error("AI elements not found");
    return;
  }

  let conversation = [];

  function displayMessage(message, isUser) {
    const msg = document.createElement("div");
    msg.className = "chat-message " + (isUser ? "user-message" : "assistant-message");
    msg.textContent = message;
    chatbox.appendChild(msg);
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  displayMessage(
    "Hey! I’m U-Know AI. What do you need assistance with today?",
    false
  );

  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;

    displayMessage(message, true);
    chatInput.value = "";

    conversation.push({ role: "user", content: message });

    const systemPrompt = `
You are Unblockify AI (U-Know AI).
You help users navigate the Unblockify site.
Answer any general questions using valid sources.
Short, clear answers only.
Go in detail if asked.
No emojis.
Speak casually.
`;

    const prompt =
      systemPrompt + "\n" +
      conversation.map(m => m.content).join("\n");

    try {
      const res = await fetch(
        "https://backend.buildpicoapps.com/aero/run/llm-api?pk=YOUR_KEY_HERE",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt })
        }
      );

      const data = await res.json();

      if (data.status === "success") {
        displayMessage(data.text, false);
        conversation.push({ role: "assistant", content: data.text });
      } else {
        displayMessage("Something went wrong.", false);
      }
    } catch {
      displayMessage("Connection error.", false);
    }
  }

  sendButton.onclick = sendMessage;
  chatInput.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });
}
</script>
